{"version":3,"sources":["model.js","static/up.png","App.js","reportWebVitals.js","index.js"],"names":["UploadVideo","obj","params","decodeURI","window","location","href","split","i","length","kv","reqParam","decodeParam","region","bucket","api","url","token","getCredential","credentials","AccessKeyId","AccessKeySecret","SecurityToken","ossClient","OSS","accessKeyId","accessKeySecret","stsToken","urllib","request","method","data","JSON","stringify","type","counts","headers","Authorization","result","parse","fileName","medias","sts","partSize","maxSize","parallel","tryCount","checkpoints","stateType","App","useState","state","setState","percent","setPercent","e","a","target","files","fileList","Array","from","file","rightType","alert","size","multipartUpload","initOSSClient","progress","onMultipartUploadProgress","then","wx","miniProgram","navigateBack","postMessage","returnCode","catch","err","Object","values","forEach","checkpoint","uploadId","num","Number","toFixed","useEffect","getParams","className","onClick","document","getElementById","click","src","icon","alt","id","accept","onChange","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","rem","htmlWidth","documentElement","clientWidth","body","getElementsByTagName","style","fontSize","onresize","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.f8d6a089.chunk.js","sourcesContent":["import OSS from \"ali-oss\";\r\n\r\nclass UploadVideo {\r\n  static partSize = 1024 * 1024; // 每个分片大小\r\n  static maxSize = 1024 * 1024 * 200; // 最大200M\r\n  static parallel = 3; // 同时上传的分片数\r\n  static tryCount = 3; //每次上传尝试3次重试\r\n  static checkpoints = {};\r\n  static ossClient;\r\n  static fileName;\r\n  static region;\r\n  static bucket;\r\n  static api;\r\n  static token;\r\n\r\n  static decodeParam() {\r\n    const obj = {};\r\n    const url = decodeURI(window.location.href);\r\n    const urlParams = url.split(\"?\")[1];\r\n    const params = urlParams.split(\"&\");\r\n\r\n    for (let i = 0; i < params.length; i++) {\r\n      const kv = params[i].split(\"=\");\r\n      obj[kv[0]] = kv[1];\r\n    }\r\n    return obj;\r\n  }\r\n  /**\r\n   * 获取参数\r\n   */\r\n  static getParams() {\r\n    const reqParam = UploadVideo.decodeParam();\r\n    UploadVideo.region = \"oss-cn-chengdu\";\r\n    UploadVideo.bucket = reqParam.bucket;\r\n    UploadVideo.api = \"https://\" + reqParam.url + \"/api/v1/media\";\r\n    UploadVideo.token = reqParam.token;\r\n  }\r\n  /**\r\n   * 生成OSSClient\r\n   */\r\n  static async initOSSClient() {\r\n    const credentials = await UploadVideo.getCredential();\r\n    const { AccessKeyId, AccessKeySecret, SecurityToken } = credentials;\r\n    UploadVideo.ossClient = new OSS({\r\n      accessKeyId: AccessKeyId,\r\n      accessKeySecret: AccessKeySecret,\r\n      stsToken: SecurityToken,\r\n      bucket: UploadVideo.bucket,\r\n      region: UploadVideo.region,\r\n    });\r\n  }\r\n  /**\r\n   * 获取fileName\r\n   * 获取sts\r\n   */\r\n  static async getCredential() {\r\n    const { api, token } = UploadVideo;\r\n    let result = await OSS.urllib.request(api, {\r\n      method: \"POST\",\r\n      data: JSON.stringify({ type: \"PV\", counts: 1 }),\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${token}`,\r\n      },\r\n    });\r\n    const data = JSON.parse(result.data);\r\n    UploadVideo.fileName = data.medias[0];\r\n    return data.sts;\r\n  }\r\n}\r\n\r\nexport default UploadVideo;\r\n","export default \"data:image/png;base64,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\"","import React, { useEffect, useState } from \"react\";\r\nimport \"./App.css\";\r\nimport UploadVideo from \"./model\";\r\nimport icon from \"./static/up.png\";\r\n\r\nconst stateType = {\r\n  before: \"before\",\r\n  loading: \"loading\",\r\n  err: \"err\",\r\n};\r\n\r\nfunction App() {\r\n  const [state, setState] = useState(stateType.before);\r\n  const [percent, setPercent] = useState(0);\r\n\r\n  useEffect(() => {\r\n    UploadVideo.getParams();\r\n  }, []);\r\n\r\n  /**\r\n   * 点击按钮: 选择视频\r\n   */\r\n  function chooseVideo() {\r\n    document.getElementById(\"fileInput\")?.click();\r\n  }\r\n  /**\r\n   * 完成视频选取, 开始上传\r\n   */\r\n  async function onChange(e) {\r\n    if (!e.target.files) {\r\n      return;\r\n    }\r\n    const fileList = Array.from(e.target.files);\r\n    const file = fileList[0];\r\n    const isRightType = rightType(file);\r\n    if (isRightType === false) {\r\n      alert(\"请上传mp4/3gp/m3u8格式的视频\");\r\n      return;\r\n    }\r\n    if (file.size > UploadVideo.maxSize) {\r\n      alert(\"上传的视频大小不能超过200M，请压缩后重新上传\");\r\n      return;\r\n    }\r\n    setState(\"loading\");\r\n    multipartUpload(file);\r\n  }\r\n  /**\r\n   * 视频格式是否符合要求\r\n   */\r\n  function rightType(file) {\r\n    alert(file.type);\r\n    if (file.type === \"video/mp4\") {\r\n      return true;\r\n    }\r\n    if (file.type === \"video/3pg\") {\r\n      return true;\r\n    }\r\n    if (file.type === \"video/m3u8\") {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n  /**\r\n   * 分片上传\r\n   */\r\n  async function multipartUpload(file) {\r\n    const { ossClient, initOSSClient } = UploadVideo;\r\n    if (!ossClient) {\r\n      await initOSSClient();\r\n    }\r\n    UploadVideo.ossClient\r\n      .multipartUpload(UploadVideo.fileName, file, {\r\n        parallel: UploadVideo.parallel,\r\n        partSize: UploadVideo.partSize,\r\n        progress: onMultipartUploadProgress,\r\n      })\r\n      .then((result) => {\r\n        window.wx.miniProgram.navigateBack();\r\n        window.wx.miniProgram.postMessage({\r\n          data: {\r\n            returnCode: \"SUCCESS\",\r\n            fileName: UploadVideo.fileName,\r\n          },\r\n        });\r\n      })\r\n      .catch((err) => {\r\n        setState(stateType.err);\r\n      });\r\n  }\r\n  // 断点续传\r\n  async function resumeMultipartUpload() {\r\n    const { checkpoints, ossClient } = UploadVideo;\r\n    setState(stateType.loading);\r\n    Object.values(checkpoints).forEach((checkpoint) => {\r\n      const { uploadId, file } = checkpoint;\r\n      ossClient\r\n        .multipartUpload(uploadId, file, {\r\n          parallel: UploadVideo.parallel,\r\n          partSize: UploadVideo.partSize, // 每个part 1MB\r\n          progress: onMultipartUploadProgress,\r\n          checkpoint,\r\n        })\r\n        .then((result) => {\r\n          delete checkpoints[checkpoint.uploadId];\r\n          window.wx.miniProgram.navigateBack();\r\n          window.wx.miniProgram.postMessage({\r\n            data: {\r\n              returnCode: \"SUCCESS\",\r\n              fileName: UploadVideo.fileName,\r\n            },\r\n          });\r\n        })\r\n        .catch((err) => {\r\n          setState(\"err\");\r\n        });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 分片上传进度改变回调\r\n   */\r\n  async function onMultipartUploadProgress(progress, checkpoint) {\r\n    let num = progress * 100;\r\n    num = Number(num.toFixed(1));\r\n    setPercent(num);\r\n    UploadVideo.checkpoints[checkpoint.uploadId] = checkpoint;\r\n  }\r\n\r\n  return (\r\n    <div className=\"page\">\r\n      {state === \"before\" && (\r\n        <div className=\"btn\" onClick={chooseVideo}>\r\n          <img src={icon} className=\"icon\" alt=\"icon\" />\r\n          点击上传视频\r\n        </div>\r\n      )}\r\n      {state === \"loading\" && (\r\n        <div className=\"loading\" id=\"loading\">\r\n          <div className=\"progress\">\r\n            <div className=\"circle loop\">\r\n              <div className=\"dot\" id=\"dotrunning\"></div>\r\n            </div>\r\n            <div className=\"num\" id=\"percent\">\r\n              {percent}%\r\n            </div>\r\n          </div>\r\n          <div className=\"info01\">视频上传中...</div>\r\n          <div className=\"info02\">为确保视频成功上传，请勿离开本页哦！</div>\r\n        </div>\r\n      )}\r\n      {state === \"err\" && (\r\n        <div className=\"btn\" onClick={resumeMultipartUpload}>\r\n          <img src={icon} className=\"icon\" alt=\"icon\" />\r\n          网络不稳定，点击尝试续传\r\n        </div>\r\n      )}\r\n      <input type=\"file\" id=\"fileInput\" accept=\"video/*\" onChange={onChange} />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","const reportWebVitals = onPerfEntry => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\n\r\nrem();\r\nwindow.onresize = () => rem();\r\nfunction rem() {\r\n  let htmlWidth = document.documentElement.clientWidth || document.body.clientWidth;\r\n  if (htmlWidth > 750) htmlWidth = 750;\r\n  let htmlDom = document.getElementsByTagName('html')[0];\r\n  htmlDom.style.fontSize = (htmlWidth / 375) * 50 + 'px';\r\n}\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}